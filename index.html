<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Finite Automata Practice — Enhanced Interactive Studio</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=">
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <!-- The splash screen is displayed on page load -->
  <div id="splashScreen"
    style="position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#667eea,#764ba2);z-index:9999;flex-direction:column;gap:20px;color:#fff;transition:opacity 0.8s ease;">
    <h1 style="font-size:3.5rem;margin:0;text-shadow:0 4px 12px rgba(0,0,0,0.4);">
      Enhanced Studio
    </h1>
    <div style="display:flex; gap: 20px;">
      <button class="splash-nav-btn" data-target="Automata"
        style="all:unset;padding:15px 30px; border-radius:12px; font-size:1.5rem; background: rgba(255,255,255,0.2); backdrop-filter: blur(5px); cursor:pointer; font-weight:700; transition: background 0.3s;">
        Finite Automata
      </button>
       <button class="splash-nav-btn" data-target="PDA" disabled
        style="all:unset;padding:15px 30px; border-radius:12px; font-size:1.5rem; background: rgba(255,255,255,0.05); cursor:not-allowed; opacity:0.6; font-weight:700;">
        PDA (Coming Soon)
      </button>
      <button class="splash-nav-btn" data-target="Turing" disabled
        style="all:unset;padding:15px 30px; border-radius:12px; font-size:1.5rem; background: rgba(255,255,255,0.05); cursor:not-allowed; opacity:0.6; font-weight:700;">
        Turing (Coming Soon)
      </button>
    </div>
  </div>

  <!-- Main application content, hidden by default -->
  <div id="mainApp" style="display:none">
    <div class="app-container" role="application" aria-label="Finite Automata Practice Studio">
      <header class="header">
        <h1>Finite Automata Practice</h1>
        <button id="panelToggleBtn" class="panel-toggle-btn">
            <i data-lucide="menu"></i>
        </button>
      </header>
      <main class="main-content">
        <!-- Control Panel (Left Sidebar) -->
        <aside id="controlPanel" class="control-panel" aria-label="Controls">
          <div class="control-section">
            <div class="control-section-header">
                <i data-lucide="sliders-horizontal"></i>
                <span>Mode & Interaction</span>
            </div>
            <div style="display:flex;gap:8px;margin-top:12px">
              <select id="modeSelect" aria-label="Mode select">
                <option value="DFA">DFA</option>
                <option value="NFA">NFA</option>
                <option value="ENFA">ε-NFA</option>
                <option value="ENFA_TO_NFA">ε-NFA → NFA</option>
                <option value="NFA_TO_DFA">NFA → DFA</option>
                <option value="NFA_TO_MIN_DFA">NFA → Minimal DFA</option>
                <option value="DFA_TO_MIN_DFA">DFA → Minimal DFA</option>
              </select>
            </div>
          </div>
          <details class="control-section" open>
            <summary>
                <i data-lucide="puzzle"></i>
                <span>Practice Generator</span>
            </summary>
            <div>
              <div style="margin-bottom:12px">
                <div style="display:flex;gap:8px">
                  <select id="practiceMode" style="flex:1;">
                    <option value="basic">Basic</option>
                    <option value="medium">Medium</option>
                    <option value="easy">Easy</option>
                    <option value="hard">Hard</option>
                  </select>
                  <button class="icon-btn" id="genPracticeBtn">Generate</button>
                </div>
                <div style="display:flex;gap:8px;margin-top:8px;align-items:center">
                  <button class="icon-btn" id="showSolBtn">Show Solution</button>
                  <button class="icon-btn" id="resetPractice">Reset</button>
                  <button class="icon-btn" id="checkAnswerBtn">Check Answer</button>
                </div>
                <div id="practiceBox">No practice generated yet.</div>
              </div>
            </div>
          </details>
          <details class="control-section">
            <summary>
                <i data-lucide="flask-conical"></i>
                <span>Testing</span>
            </summary>
            <div>
              <div class="controls-group">
                <div class="test-panel">
                  <div class="input"><input id="testInput" placeholder="Enter string (e.g., abbab)" /></div>
                  <button id="runTestBtn" class="run-btn">Run</button>
                </div>
                <div id="randomStringBox">
                  <i data-lucide="dice-5"></i> <button id="genRandBtn" class="icon-btn">Random</button>
                </div>
                <details id="testOptionsCollapse">
                  <summary><i data-lucide="settings-2"></i> Simulation Options</summary>
                  <div id="testOptions">
                    <label><input type="radio" name="simMode" value="auto" checked>
                      Auto</label>
                    <label><input type="radio" name="simMode" value="manual"> Manual</label>
                    <label>Speed:
                      <select id="testSpeed">
                        <option value="500">Fast</option>
                        <option value="1000">Normal</option>
                        <option value="2000" selected>Slow</option>
                      </select>
                    </label>
                    <div id="manualButtons" style="display:none;">
                      <button id="stepPrev" class="icon-btn">◀ Prev</button>
                      <button id="stepNext" class="icon-btn">Next ▶</button>
                      <button id="stepReset" class="icon-btn">⟲ Reset</button>
                    </div>
                  </div>
                </details>
                <div id="testOutput" class="output-display">Ready</div>
              </div>
            </div>

            <div style="border-top:1px solid #e6eef8;margin-top:12px;padding-top:12px;">
              <details id="bulkTestSection">
                <summary><i data-lucide="test-tubes"></i> Bulk Testing</summary>
                <div>
                  <textarea id="bulkTestInput" placeholder="Enter test strings (one per line)..."></textarea>
                  <button id="bulkRunBtn" class="icon-btn" style="margin-top:8px;width:100%;">Run Bulk Test</button>
                  <div id="bulkTestOutput">
                  </div>
                </div>
              </details>
            </div>
          </details>
          <details class="control-section">
            <summary>
                <i data-lucide="folder"></i>
                <span>File</span>
            </summary>
            <div class="control-row">
              <button id="saveMachineBtn" title="Save machine (JSON)"><i data-lucide="save"></i> Save</button>
              <button id="loadMachineBtn" title="Load machine (JSON)"><i data-lucide="folder-open"></i> Load</button>
            </div>
            <div class="control-row">
              <button id="exportPngBtn" title="Export canvas as PNG"><i data-lucide="image"></i> Export PNG</button>
            </div>
            <input type="file" id="loadFileInput" accept=".json" style="display:none" />
          </details>


          <details class="control-section" id="librarySection">
            <summary>
                <i data-lucide="library"></i>
                <span>Library</span>
            </summary>
            <div>
              <div style="display:flex;gap:8px;margin-bottom:10px;align-items:center">
                <input id="libSearch" placeholder="Search..." />
                <select id="libFilter">
                  <option value="all">All Types</option>
                  <option value="DFA">DFA</option>
                  <option value="NFA">NFA</option>
                  <option value="ENFA">ε-NFA</option>
                </select>
                <button id="libRefresh" class="icon-btn" title="Refresh library"><i data-lucide="refresh-cw"></i></button>
              </div>
              <div id="libraryList">
                <div>Library empty — click Refresh to load.</div>
              </div>
              <div style="margin-top:8px;display:flex;gap:8px">
                <button id="openLibJson" class="icon-btn"><i data-lucide="file-json-2"></i> Open JSON</button>
                <button id="downloadLib" class="icon-btn"><i data-lucide="download"></i> Download ZIP</button>
              </div>
            </div>
          </details>
        </aside>

        <!-- Visualization Panel (Main Area) -->
        <section class="visualization-panel" id="visualization-panel" aria-label="Visualization" style="position: relative;">
          <div class="visualization-header" style="display:flex;align-items:center;gap:12px;">
            <div style="flex:1"><strong>Automata Visualization</strong>
              <div class="kv">Mode: <span id="modeLabel">DFA</span></div>
            </div>
          </div>
          <div class="canvas-wrapper" id="canvasWrapper">
            <div class="canvas-top">
              <div class="canvas-toolbar" role="toolbar" aria-label="Canvas toolbar">
                <div class="toolbar-icon" id="tool-addclick" title="Add state on canvas click" data-mode="addclick"><i
                    data-lucide="plus-circle"></i></div>
                <div class="toolbar-icon" id="tool-move" title="Move states" data-mode="move"><i data-lucide="move"
                    ></i></div>
                <div class="toolbar-icon" id="tool-transition" title="Add transition" data-mode="transition"><i
                    data-lucide="git-branch"></i></div>
                <div class="toolbar-icon" id="tool-rename" title="Rename state" data-mode="rename"><i
                    data-lucide="edit-3"></i></div>
                <div class="toolbar-icon" id="tool-delete" title="Delete state/transition" data-mode="delete"><i
                    data-lucide="trash-2"></i></div>
                <div class="toolbar-icon" id="tool-stateprops" title="Set state properties" data-mode="stateprops"><i
                    data-lucide="settings"></i></div>

                <button id="validateBtn" class="toolbar-icon" title="Validate Automaton" style="margin-left:8px"><i
                    data-lucide="check-circle"></i></button>

                <div class="toolbar-icon" id="clearCanvasBtn" title="Clear Canvas"><i data-lucide="file-x"></i></div>

                <div id="validationLine" class="validation-box"></div>

                <button id="undoBtn" class="toolbar-icon" title="Undo" style="margin-left:auto;"><i
                    data-lucide="corner-up-left"></i></button>
                <button id="redoBtn" class="toolbar-icon" title="Redo"><i data-lucide="corner-up-right"></i></button>
              </div>
            </div>
            <div class="canvas-area">
              <div class="svg-canvas" id="svgWrapper" tabindex="0">
                <svg id="dfaSVG" viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg" role="img"
                  aria-label="Automaton canvas">
                  <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                      <polygon points="0 0, 10 3.5, 0 7" fill="#667eea" />
                    </marker>
                    <marker id="arrowhead-export" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                      <polygon points="0 0, 10 3.5, 0 7" fill="#000000" />
                    </marker>
                  </defs>
                  <g id="edges"></g>
                  <g id="states"></g>
                  <text id="canvasHint" x="700" y="420" text-anchor="middle" fill="#9aa6b2" font-size="18">Tap canvas to
                    add a state (use ➕ tool)</text>
                </svg>
              </div>
            </div>
          </div>

          <div class="zoom-controls" style="position: absolute; right: 30px; top: 150px; z-index: 50;">
            <button id="zoomInBtn" class="toolbar-icon" title="Zoom In"><i data-lucide="zoom-in"></i></button>
            <input id="zoomSlider" type="range" min="50" max="200" value="100" />
            <button id="zoomOutBtn" class="toolbar-icon" title="Zoom Out"><i data-lucide="zoom-out"></i></button>
            <button id="zoomResetBtn" class="toolbar-icon" title="Reset Zoom"><i data-lucide="refresh-ccw"></i></button>
          </div>
        </section>
      </main>
      <div style="max-width:1400px;margin:8px auto 0 auto;padding:0 18px;">
        <div style="display:flex;gap:12px;align-items:center;margin-top:8px">
          <div style="flex:1" id="stepLog">Step log appears here.</div>
        </div>
      </div>
    </div>

    <!-- Modals for user interaction -->
    <div id="transitionModal" class="modal-overlay" style="display:none">
        <div class="modal-box">
            <h3>Add Transition</h3>
            <p class="modal-description">Enter the symbol for the transition. Use a blank input for an epsilon (ε) transition in an NFA.</p>
            <div style="display:flex;gap:8px;margin-bottom:8px">
                <input id="transFrom" class="modal-input" readonly />
                <input id="transTo" class="modal-input" readonly />
            </div>
            <input id="transSymbol" class="modal-input" placeholder="Symbol (blank for ε)" />
            <div class="modal-actions">
                <button id="transCancel">Cancel</button>
                <button id="transSave">Save</button>
            </div>
        </div>
    </div>
    <div id="statePropsModal" class="modal-overlay" style="display:none">
        <div class="modal-box">
            <h3>State Properties</h3>
            <p class="modal-description">Set whether this state is an initial or a final (accepting) state.</p>
            <div class="modal-prop-row">
                <label><input type="checkbox" id="propInitial"> Initial State</label>
            </div>
            <div class="modal-prop-row">
                <label><input type="checkbox" id="propFinal"> Final State</label>
            </div>
            <div class="modal-actions">
                <button id="propCancel">Cancel</button>
                <button id="propSave">Save</button>
            </div>
        </div>
    </div>
    <div id="renameModal" class="modal-overlay" style="display:none">
        <div class="modal-box">
            <h3>Rename State</h3>
            <p class="modal-description">Enter the new name for the state. It must be unique.</p>
            <input id="renameInput" class="modal-input" placeholder="New state name" />
            <div class="modal-actions">
                <button id="renameCancel">Cancel</button>
                <button id="renameSave">Save</button>
            </div>
        </div>
    </div>
    <div id="confirmClearModal" class="modal-overlay" style="display:none">
        <div class="modal-box">
            <h3>Clear Canvas</h3>
            <p class="modal-description">Are you sure you want to clear the entire canvas? This action can be undone.</p>
            <div class="modal-actions">
                <button id="confirmClearCancel">Cancel</button>
                <button id="confirmClearConfirm" class="danger-btn">Clear Canvas</button>
            </div>
        </div>
    </div>
    <div id="alertModal" class="modal-overlay" style="display:none">
        <div class="modal-box">
            <h3 id="alertModalTitle">Alert</h3>
            <p id="alertModalMessage" class="modal-description"></p>
            <div class="modal-actions">
                <button id="alertModalClose">OK</button>
            </div>
        </div>
    </div>

  <!-- FIX: Converted all scripts to type="module" for consistency. -->
  <!-- This ensures a predictable loading order and avoids global scope pollution. -->
  <script type="module" src="practice-bank.js"></script>
  <script type="module" src="library-loader.js"></script>
  <script type="module" src="library_helper.js"></script>
  <script type="module" src="utils.js"></script>
  <script type="module" src="state.js"></script>
  <script type="module" src="renderer.js"></script>
  <script type="module" src="automata.js"></script>
  <script type="module" src="simulation.js"></script>
  <script type="module" src="practice.js"></script>
  <script type="module" src="file.js"></script>
  <script type="module" src="animation.js"></script>
  <script type="module" src="ui.js"></script>
  <script type="module" src="main.js"></script>

</body>

</html>


